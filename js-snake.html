<!DOCTYPE html>
<html>
<head>

    <title>JS Snake Game</title>

</head>
<body>
    <canvas height = "500" width="500" style="border:2px solid #000" id="ctx"></canvas>
    <script>
    
    let ctx = document.getElementById('ctx').getContext('2d');
    let WIDTH = 500;
    let HEIGHT = 500;
    let snakeList, foodList, direction, eaten, intervalVar, score;
    ctx.font = "20px Calibri";

    let snakeBody = {
        width:20,
        height:20,
        color: 'green'
    };

    let food = {
        width:20, 
        height:20,
        color: 'orange'
    };
    //directions: 0 = left 1=up 2=right 3=down (we changing to use arrow keys)
    document.onkeydown = function(event) {
        if(event.keyCode == 37) {
            direction = 0;
            console.log('0');
        }
        else if (event.keyCode == 38) {
            direction = 1;
            console.log('1');
        }
        else if (event.keyCode == 39) {
            direction = 2;
            console.log('2');
        }
        else if (event.keyCode == 40) {
            direction = 3;
            console.log('3');
        }
    }

    testCollision = function(rect1, rect2) { //food + head collision)
        return ((rect1.x <= rect2.x + food.width) &&
                (rect2.x <= rect1.x + snakeBody.width) &&
                (rect1.y <= rect2.y + food.height) &&
                (rect2.y <= rect1.y + snakeBody.height));
    }

    testCollisionSnake = function(snake1, snake2) { //different way of colision
        return((Math.abs(snake1.x-snake2.x)<5) &&
                (Math.abs(snake1.y-snake2.y)<5)

        );
    }

    drawSnake = function (sb, i) {
        ctx.save();
        if (i == 0) {
            ctx.fillStyle = 'black';
        } else {
            ctx.fillStyle = snakeBody.color;
            
        }
        ctx.fillRect(sb.x,sb.y,snakeBody.width, snakeBody.height);
        ctx.restore();
            
        
    }

    drawFood = function(f, i) {
        ctx.save();
        ctx.fillStyle = food.color;
        ctx.fillRect(f.x,f.y,food.width, food.height);
        ctx.restore();
    }

    updateSnakeList = function() {
        for (var i = snakeList.length-1;i>=0;i--) {
            if(direction == 0) { //left
                if(i==0) { //if i is the snakes head
                    snakeList[i].x = snakeList[i].x - 5;
                } else {
                    snakeList[i].x = snakeList[i-1].x;
                    snakeList[i].y = snakeList[i-1].y;
                }
            }
            else if(direction == 1){ //up
                if(i==0) { //if i is the snakes head
                    snakeList[i].y = snakeList[i].y - 5;
                } else {
                    snakeList[i].x = snakeList[i-1].x;
                    snakeList[i].y = snakeList[i-1].y;
                }
            }
            else if(direction == 2){ //right
                if(i==0) { //if i is the snakes head
                    snakeList[i].x = snakeList[i].x + 5;
                } else {
                    snakeList[i].x = snakeList[i-1].x;
                    snakeList[i].y = snakeList[i-1].y;
                }
            }
            else if(direction == 3){ //down
                if(i==0) { //if i is the snakes head
                    snakeList[i].y = snakeList[i].y + 5;
                } else {
                    snakeList[i].x = snakeList[i-1].x;
                    snakeList[i].y = snakeList[i-1].y;
                }
            }
        }
    }

    checkSnakePosition = function() {
        if (snakeList[0].x > 500) {
            snakeList[0].x = 0;
        }
        if (snakeList[0].x < 0) {
            snakeList[0].x = 500;
        }
        if (snakeList[0].y > 500) {
            snakeList[0].y = 0;
        }
        if (snakeList[0].y < 0) {
            snakeList[0].y = 500;
        }
    }

    isGameOver = function () {
        for (i in snakeList) {
            if (i==0) {
                continue;
            }
            if (testCollisionSnake(snakeList[0], snakeList[i])) {
                clearInterval(intervalVar);
                return;
            }
        }
    }

    updateSnakePosition = function() {
        ctx.clearRect(0,0,WIDTH,HEIGHT); //erase full canvas and redraw it
        while(eaten) {
            let pos_x = Math.random()*485+5;
            let pos_y = Math.random()*485+5;
            foodList[0] = {x:pos_x,y:pos_y};
            eaten = false;
        }
        foodList.forEach(drawFood);
        snakeList.forEach(drawSnake);

        if (testCollision(snakeList[0], foodList[0])) { //collision of food and snake head + create new head unshift
            foodList = [];
            eaten = true;
            score += 1;
            let new_X, new_Y;
            if (direction == 0) {
                new_X = snakeList[0].x -10; //food will appear IN FRONT of the head, and then its added to array unshift
                new_Y = snakeList[0].y;
            }
            else if (direction == 1) {
                new_X = snakeList[0].x;
                new_Y = snakeList[0].y-10;
            }
            else if (direction == 2) {
                new_X = snakeList[0].x +10;
                new_Y = snakeList[0].y;
            }
            else if (direction == 3) {
                new_X = snakeList[0].x;
                new_Y = snakeList[0].y+10;
            }
            snakeList.unshift({x:new_X, y:new_Y}); //so this will be the new head of snake
        }
        ctx.fillText('Score: ' + score, 420, 40)
        isGameOver();
        checkSnakePosition();
        updateSnakeList();

    }

    startGame = function() {
        snakeList = [
            {x:220, y:200},
            {x:210, y:200},
            {x:200, y:200}
        ];
        foodList = [];
        direction = 99;
        eaten = true;
        score = 0;
        intervalVar = setInterval(updateSnakePosition, 25); //setInterval returns a unique integer that we can catch and then use to stop it
    }

    startGame();

    
    </script>
    
</body>
</html>